"use strict";(self.webpackChunkdocusaurus_blog=self.webpackChunkdocusaurus_blog||[]).push([[8377],{4226:(e,t,n)=>{n.r(t),n.d(t,{default:()=>h});var s=n(6540),a=n(594),r=n(9813);const i={container:"container_tMk4",appContainer:"appContainer_WvhC",header:"header_IH4k",controlsTop:"controlsTop_O_9l",card:"card_T1WZ",label:"label_Er9Y",inputWrapper:"inputWrapper_yQrJ",numberInput:"numberInput_XdTM",iconBtn:"iconBtn_EZs2",slider:"slider_xVZd",subBpmRow:"subBpmRow_cE49",subBpmInput:"subBpmInput_ILPE",inputGroup:"inputGroup_anpn",patternEditor:"patternEditor_uvQm",patternGrid:"patternGrid_ILzW",gridCell:"gridCell_b_N5",gridCellActive:"gridCellActive_raHs",gridCellPlaying:"gridCellPlaying_ZIGJ",toggleContainer:"toggleContainer__c0u",switch:"switch_ZLy1",sliderSwitch:"sliderSwitch_QW8Y",actionArea:"actionArea_WZLj",playBtn:"playBtn_oKAS",playBtnPlaying:"playBtnPlaying_bMzJ",presetsContainer:"presetsContainer_BCih",presetControls:"presetControls_dNmC",presetNameInput:"presetNameInput_koX6",btnSecondary:"btnSecondary_Cjl6",presetList:"presetList_vIGF",presetItem:"presetItem_IMhb",presetName:"presetName_VuuF",btnDelete:"btnDelete_g0Bk"};var l=n(4848);class c{constructor(e){this.audioContext=null,this.isPlaying=!1,this.current16thNote=0,this.nextNoteTime=0,this.timerID=null,this.lookahead=25,this.scheduleAheadTime=.1,this.bpm=100,this.patternLength=4,this.stepsPerBeat=4,this.pattern=[!0,!1,!1,!1],this.accentFirstBeat=!0,this.onBeatCallback=e}init(){const e=window.AudioContext||window.webkitAudioContext;this.audioContext=new e}nextNote(){const e=60/this.bpm/this.stepsPerBeat;this.nextNoteTime+=e,this.current16thNote++,this.current16thNote>=this.patternLength&&(this.current16thNote=0)}scheduleNote(e,t){if(this.pattern[e]){const n=this.audioContext.createOscillator(),s=this.audioContext.createGain();n.connect(s),s.connect(this.audioContext.destination),this.accentFirstBeat&&0===e?n.frequency.value=880:n.frequency.value=440,s.gain.setValueAtTime(1,t),s.gain.exponentialRampToValueAtTime(.001,t+.1),n.start(t),n.stop(t+.1)}}scheduler(){for(;this.nextNoteTime<this.audioContext.currentTime+this.scheduleAheadTime;){if(this.scheduleNote(this.current16thNote,this.nextNoteTime),this.onBeatCallback){const e=1e3*(this.nextNoteTime-this.audioContext.currentTime),t=this.current16thNote;setTimeout(()=>{this.onBeatCallback(t)},Math.max(0,e))}this.nextNote()}this.isPlaying&&(this.timerID=window.setTimeout(this.scheduler.bind(this),this.lookahead))}start(){this.isPlaying||(this.audioContext||this.init(),"suspended"===this.audioContext.state&&this.audioContext.resume(),this.isPlaying=!0,this.current16thNote=0,this.nextNoteTime=this.audioContext.currentTime+.1,this.scheduler())}stop(){this.isPlaying=!1,window.clearTimeout(this.timerID)}}function o(){const[e,t]=(0,s.useState)(100),[n,a]=(0,s.useState)(4),[r,o]=(0,s.useState)(4),[h,p]=(0,s.useState)(!0),[u,d]=(0,s.useState)([!0,!1,!1,!1]),[m,x]=(0,s.useState)(!1),[g,N]=(0,s.useState)(-1),[b,C]=(0,s.useState)({}),[j,y]=(0,s.useState)(""),v=(0,s.useRef)(null),B="metronomePresetsMap",_="metronomeSettings";(0,s.useEffect)(()=>{v.current=new c(e=>{N(e)});const e=localStorage.getItem(_);if(e)try{const n=JSON.parse(e);n.bpm&&t(n.bpm),n.patternLength&&a(n.patternLength),n.stepsPerBeat&&o(n.stepsPerBeat),void 0!==n.accent&&p(n.accent),n.pattern&&Array.isArray(n.pattern)&&n.pattern.length===n.patternLength?d(n.pattern):n.patternLength&&f(n.patternLength,n.pattern||[])}catch(s){console.error(s)}const n=localStorage.getItem(B);if(n)try{C(JSON.parse(n))}catch(s){}return()=>{v.current&&v.current.stop()}},[]),(0,s.useEffect)(()=>{if(!v.current)return;v.current.bpm=e,v.current.patternLength=n,v.current.stepsPerBeat=r,v.current.pattern=u,v.current.accentFirstBeat=h;const t={bpm:e,patternLength:n,stepsPerBeat:r,pattern:u,accent:h};localStorage.setItem(_,JSON.stringify(t))},[e,n,r,u,h]);const f=(e,t=u)=>{const n=[];for(let s=0;s<e;s++)s<t.length?n.push(t[s]):n.push(!1);d(n)},k=e=>{let n=parseFloat(e);isNaN(n)||t(Math.min(300,Math.max(1,n)))},S=(e,t=null)=>{let s=null!==t?parseInt(t):n+e;isNaN(s)&&(s=4),s=Math.min(128,Math.max(1,s)),a(s),f(s)},I=(e,t=null)=>{let n=null!==t?parseInt(t):r+e;isNaN(n)&&(n=4),n=Math.min(32,Math.max(1,n)),o(n)},P=()=>{const t=j.trim();if(!t)return;const s={...b,[t]:{bpm:e,patternLength:n,stepsPerBeat:r,pattern:u,accent:h}};C(s),localStorage.setItem(B,JSON.stringify(s)),y("")},w=Math.round(e*r);return(0,l.jsx)("div",{className:i.container,children:(0,l.jsxs)("div",{className:i.appContainer,children:[(0,l.jsx)("header",{className:i.header,children:(0,l.jsx)("h1",{children:"\u7bc0\u62cd\u5668 Metronome"})}),(0,l.jsxs)("div",{className:i.controlsTop,children:[(0,l.jsxs)("div",{className:i.card,children:[(0,l.jsx)("label",{className:i.label,children:"\u901f\u5ea6 BPM"}),(0,l.jsxs)("div",{className:i.inputWrapper,children:[(0,l.jsx)("button",{className:i.iconBtn,onClick:()=>k(e-1),children:"-"}),(0,l.jsx)("input",{type:"number",className:i.numberInput,value:Number.isInteger(e)?e:e.toFixed(1),onChange:e=>k(e.target.value)}),(0,l.jsx)("button",{className:i.iconBtn,onClick:()=>k(e+1),children:"+"})]}),(0,l.jsx)("input",{type:"range",className:i.slider,min:"1",max:"300",value:e,onChange:e=>k(e.target.value)}),(0,l.jsxs)("div",{className:i.subBpmRow,children:[(0,l.jsx)("label",{className:i.label,children:"\u7d30\u5206\u62cd\u901f\u5ea6 Subdivision BPM"}),(0,l.jsx)("input",{type:"number",className:i.subBpmInput,value:w,onChange:e=>(e=>{const n=parseFloat(e);if(isNaN(n))return;const s=n/r;t(Math.min(300,Math.max(1,s)))})(e.target.value)})]})]}),(0,l.jsxs)("div",{className:i.card,children:[(0,l.jsxs)("div",{className:i.inputGroup,children:[(0,l.jsxs)("label",{className:i.label,children:["\u6a23\u5f0f\u9577\u5ea6 (\u6b65\u6578)",(0,l.jsx)("br",{}),"Pattern Length"]}),(0,l.jsxs)("div",{className:i.inputWrapper,children:[(0,l.jsx)("button",{className:i.iconBtn,onClick:()=>S(-1),children:"-"}),(0,l.jsx)("input",{type:"number",className:i.numberInput,style:{fontSize:"1.5rem",width:"80px"},value:n,onChange:e=>S(0,e.target.value)}),(0,l.jsx)("button",{className:i.iconBtn,onClick:()=>S(1),children:"+"})]})]}),(0,l.jsxs)("div",{className:i.inputGroup,style:{marginTop:"1rem"},children:[(0,l.jsxs)("label",{className:i.label,children:["\u6bcf\u62cd\u6b65\u6578",(0,l.jsx)("br",{}),"Steps / Beat"]}),(0,l.jsxs)("div",{className:i.inputWrapper,children:[(0,l.jsx)("button",{className:i.iconBtn,onClick:()=>I(-1),children:"-"}),(0,l.jsx)("input",{type:"number",className:i.numberInput,style:{fontSize:"1.5rem",width:"80px"},value:r,onChange:e=>I(0,e.target.value)}),(0,l.jsx)("button",{className:i.iconBtn,onClick:()=>I(1),children:"+"})]})]})]})]}),(0,l.jsxs)("div",{className:i.patternEditor,children:[(0,l.jsx)("p",{children:"\u9ede\u64ca\u5207\u63db\u7bc0\u62cd Toggle beats to play"}),(0,l.jsx)("div",{className:i.patternGrid,children:u.map((e,t)=>(0,l.jsx)("div",{onClick:()=>(e=>{const t=[...u];t[e]=!t[e],d(t)})(t),className:`\n                  ${i.gridCell} \n                  ${e?i.gridCellActive:""} \n                  ${g===t?i.gridCellPlaying:""}\n                `,children:t+1},t))}),(0,l.jsxs)("div",{className:i.toggleContainer,children:[(0,l.jsxs)("label",{className:i.switch,children:[(0,l.jsx)("input",{type:"checkbox",checked:h,onChange:e=>p(e.target.checked)}),(0,l.jsx)("span",{className:i.sliderSwitch})]}),(0,l.jsx)("span",{className:i.label,style:{textTransform:"none",marginLeft:"8px"},children:"\u5f37\u8abf\u9996\u62cd Accent First Beat"})]})]}),(0,l.jsx)("div",{className:i.actionArea,children:(0,l.jsx)("button",{className:`${i.playBtn} ${m?i.playBtnPlaying:""}`,onClick:()=>{v.current&&(m?(v.current.stop(),x(!1),N(-1)):(v.current.start(),x(!0)))},children:m?"\u25a0":"\u25b6"})}),(0,l.jsxs)("div",{className:i.presetsContainer,children:[(0,l.jsx)("h3",{children:"\u9810\u8a2d\u7d44 Presets"}),(0,l.jsxs)("div",{className:i.presetControls,children:[(0,l.jsx)("input",{type:"text",className:i.presetNameInput,placeholder:"\u540d\u7a31 Name (e.g. Rock 120)",value:j,onChange:e=>y(e.target.value),onKeyPress:e=>"Enter"===e.key&&P()}),(0,l.jsx)("button",{className:i.btnSecondary,onClick:P,children:"\u5132\u5b58 Save"})]}),(0,l.jsxs)("ul",{className:i.presetList,children:[Object.keys(b).sort().map(e=>(0,l.jsxs)("li",{className:i.presetItem,children:[(0,l.jsx)("span",{className:i.presetName,onClick:()=>(e=>{const n=b[e];n&&(n.bpm&&t(n.bpm),n.patternLength&&(a(n.patternLength),n.pattern&&n.pattern.length===n.patternLength?d(n.pattern):f(n.patternLength,n.pattern||[])),n.stepsPerBeat&&o(n.stepsPerBeat),void 0!==n.accent&&p(n.accent))})(e),children:e}),(0,l.jsx)("button",{className:i.btnDelete,onClick:t=>((e,t)=>{if(t.stopPropagation(),!window.confirm(`Delete preset "${e}"?`))return;const n={...b};delete n[e],C(n),localStorage.setItem(B,JSON.stringify(n))})(e,t),children:"\xd7"})]},e)),0===Object.keys(b).length&&(0,l.jsx)("li",{style:{color:"var(--text-secondary)",fontSize:"0.8rem",textAlign:"center",padding:"10px"},children:"\u7121\u9810\u8a2d\u7d44 No presets"})]})]})]})})}function h(){return(0,l.jsx)(a.A,{title:"Metronome",description:"Custom Web Metronome",children:(0,l.jsx)(r.A,{fallback:(0,l.jsx)("div",{style:{padding:"2rem",color:"white"},children:"Loading Metronome..."}),children:()=>(0,l.jsx)(o,{})})})}},9813:(e,t,n)=>{n.d(t,{A:()=>r});n(6540);var s=n(1062),a=n(4848);function r({children:e,fallback:t}){return(0,s.A)()?(0,a.jsx)(a.Fragment,{children:e?.()}):t??null}}}]);