<!doctype html>
<html lang="zh-TW" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">1 篇文章 含有標籤「Programming」 | Shen Jing</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://Shen-Jing.github.io/img/ShneJing_social-card_1200_800.png"><meta data-rh="true" name="twitter:image" content="https://Shen-Jing.github.io/img/ShneJing_social-card_1200_800.png"><meta data-rh="true" property="og:url" content="https://Shen-Jing.github.io/blog/tags/programming"><meta data-rh="true" property="og:locale" content="zh_TW"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh-TW"><meta data-rh="true" name="docsearch:language" content="zh-TW"><meta data-rh="true" property="og:title" content="1 篇文章 含有標籤「Programming」 | Shen Jing"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/ShenJing_favicon48_48.png"><link data-rh="true" rel="canonical" href="https://Shen-Jing.github.io/blog/tags/programming"><link data-rh="true" rel="alternate" href="https://Shen-Jing.github.io/blog/tags/programming" hreflang="zh-TW"><link data-rh="true" rel="alternate" href="https://Shen-Jing.github.io/en/blog/tags/programming" hreflang="en"><link data-rh="true" rel="alternate" href="https://Shen-Jing.github.io/blog/tags/programming" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Shen Jing RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Shen Jing Atom Feed"><link rel="stylesheet" href="/assets/css/styles.6d92ae8b.css">
<script src="/assets/js/runtime~main.5c56998b.js" defer="defer"></script>
<script src="/assets/js/main.f27d2664.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/ShenJing_logo_120_80.png"><div role="region" aria-label="跳至主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳至主要内容</a></div><nav aria-label="主導航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切換導覽列" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/ShenJing_logo_120_80.png" alt="審經，偶爾神經" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/ShenJing_logo_120_80.png" alt="審經，偶爾神經" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Shen Jing</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">貼文</a><a class="navbar__item navbar__link" href="/blog/archive">貼文列表</a><a class="navbar__item navbar__link" href="/mediashelf/Introduction">媒體櫃</a><a class="navbar__item navbar__link" href="/about">關於我</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切換淺色/深色模式（當前為system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近部落格文章導覽"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/kobo-highlights-lost">【記錄】Kobo 劃記遺失驚魂記</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/social-media">【心情札記】退追不移粉？近期對社群軟體的小感</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/Docusaurus_settings">【Cheat Sheet】Docusaurus 記錄</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/My MuseScore">【Cheat Sheet】MuseScore 新手記錄</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025_farewell_grandparent">【心情札記】再見爺爺奶奶</a></li></ul></div></nav></aside><main class="col col--7"><header class="margin-bottom--xl"><h1>1 篇文章 含有標籤「Programming」</h1><a href="/blog/tags">檢視所有標籤</a></header><article class="margin-bottom--xl"><header><h2 class="title_xvU1"><a href="/blog/kobo-highlights-lost">【記錄】Kobo 劃記遺失驚魂記</a></h2><div class="container_iJTo margin-vert--md"><time datetime="2025-10-01T00:00:00.000Z">2025年10月1日</time> · <!-- -->閱讀時間約 6 分鐘</div></header><div class="markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a href="#前言" class="hash-link" aria-label="前言的直接連結" title="前言的直接連結" translate="no">​</a></h2>
<p>去年入坑閱讀器 <sup><a href="#user-content-fn-ereader-a4d644" id="user-content-fnref-ereader-a4d644" data-footnote-ref="true" aria-describedby="footnote-label" class="footnoteRefStickyNavbar_i6ta">1</a></sup> 時，我也一併試用了 Readwise 2 個月，主要是看上它可以同步 Kobo 的閱讀劃記，並且輸出到 Notion。<br>
<!-- -->實際使用後最吸引我的是「劃記回顧」的功能，可以指定哪幾本書要以何等頻率發送 email 複習。由於我主要讀的是比較偏理論的書籍，所以非常中意這個功能！</p>
<p>不過問題是我不太想再增加我手上的訂閱產品了，雖然 6 鎂 / 月看似還好，但累積起來也是挺可觀的……而且當時還不確定自己能不能堅持閱讀的習慣。<br>
<!-- -->那時剛好有訂 Perplexity 付費版，於是就趁這個機會和它協作出一個也能匯出劃記到 Notion 書庫、每日寄出 email 的小腳本。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="export-kobo-小成果">export-kobo 小成果<a href="#export-kobo-小成果" class="hash-link" aria-label="export-kobo 小成果的直接連結" title="export-kobo 小成果的直接連結" translate="no">​</a></h3>
<p>基於 <a href="https://github.com/pettarin/export-kobo" target="_blank" rel="noopener noreferrer">pettarin/export-kobo</a> 的架構，初版在 2025 年 1 月完成。</p>
<p>以《我想跟你好好說話》為例，這是輸出到 Notion 的樣子（預設直輸到頁面尾端，並以 toggleable 的 H3 標題為區塊）：<br>
<img decoding="async" loading="lazy" alt="talk" src="/assets/images/Notion_Highlights-167d114fba06efa22acb1438c17d9c3e.png" width="1076" height="1032" class="img_ev3q"></p>
<p>還有我愛的複習功能：<br>
<img decoding="async" loading="lazy" alt="review" src="/assets/images/to_email-33e451d36ecafa5f03287c60866961ff.jpg" width="1606" height="293" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="主要難點">主要難點<a href="#主要難點" class="hash-link" aria-label="主要難點的直接連結" title="主要難點的直接連結" translate="no">​</a></h4>
<ul>
<li>KoboReader.sqlite 的 Bookmark 資料排序困難，有 <code>StartContainerPath</code>，但資訊不夠充足，排下去亂成一團。<br>
<!-- -->（最後我粗暴的 work around 是利用 <code>DateCreated</code>，畢竟我自己看書都是從頭照順序看）</li>
<li>原本是利用中文標題去和 Notion 頁面連結，但我基本資料是先用 Save To Notion 從博客來頁面去抓的，中文書名與 Kobo 資料庫不一致。<!-- -->
<ul>
<li>解法：用 ISBN 做配對，<strong>但是</strong> 電子書與實體書的 ISBN 不一樣，而且其中一個書城還會混用兩者。因此我只好在輸出前除了列出標題方便選取以外，還多列 Kobo 資料庫內的 ISBN，用工人智慧複製貼上到 Notion 頁面讓它可以吻合……<br>
<!-- -->否則就是預設輸出到 ISBN 為 0 的頁面，接著我再手動去剪下貼上輸出的結果。</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="學習點">學習點<a href="#學習點" class="hash-link" aria-label="學習點的直接連結" title="學習點的直接連結" translate="no">​</a></h4>
<ul>
<li>使用 Windows 的 Task Scheduler 排程 powershell 腳本並間接呼叫 WSL2 的 python script</li>
<li>用 .env 包機密資訊</li>
<li>用 Python 寄 email</li>
<li>用 Python 串 Notion API：這點 AI 真的幫了大忙，省去慢慢看官方文件的時間</li>
<li>複習 SQL <sup><a href="#user-content-fn-sql-a4d644" id="user-content-fnref-sql-a4d644" data-footnote-ref="true" aria-describedby="footnote-label" class="footnoteRefStickyNavbar_i6ta">2</a></sup></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="事件如何發生">事件如何發生<a href="#事件如何發生" class="hash-link" aria-label="事件如何發生的直接連結" title="事件如何發生的直接連結" translate="no">​</a></h2>
<p>在多開閱讀（同時期不只讀一本書）下，我大概是一個月會有一本書讀完並需要整理劃記，這也成為我會手動備份 KoboReader.sqlite 的時機點。<br>
<!-- -->這次因為比較懶，所以就直接沒有額外備份一份，只有單純以上次 7 月時的版本作為備份。</p>
<p>而意外就發生在我執行完腳本後又快速地再重複執行一次，結果壞檔：<br>
<img decoding="async" loading="lazy" alt="sql_broken" src="/assets/images/sqlite_broken-3bf30f7c5607a646466783ff853ba89b.png" width="1634" height="1543" class="img_ev3q"></p>
<p>這個錯誤訊息會發生在讀取 sqlite 遇到狀況時拋出的 exception。<br>
<!-- -->（老實說這是不是當下第一時間的狀況圖我也不確定，因為從可擷取劃記的書本數量來看是偏少的，但從前後執行結果推論又是第一現場的最佳可能）<br>
<!-- -->推測可能是因為底層還沒將 sqlite-shm (Shared Memory) 或 sqlite-wal (Write-Ahead Logging) 等等的檔案整合回去（有誤還敬請斧正，我外行XD）。</p>
<p>這時最奇妙的是，我再重新插線閱讀器取出 sqlite，問題依舊存在——我甚至開始懷疑是不是我 <kbd>Ctrl</kbd> <kbd>c</kbd> / <kbd>v</kbd> 太順，所以不小心把毀損的檔案覆蓋掉閱讀器上的檔案。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="debug-思路">Debug 思路<a href="#debug-思路" class="hash-link" aria-label="Debug 思路的直接連結" title="Debug 思路的直接連結" translate="no">​</a></h2>
<p>事到如今只能認了，不過還是記錄一些 debug 過程<sup><a href="#user-content-fn-memo-a4d644" id="user-content-fnref-memo-a4d644" data-footnote-ref="true" aria-describedby="footnote-label" class="footnoteRefStickyNavbar_i6ta">3</a></sup>，也算是更認識到 Kobo 有哪些資料可以運用吧。</p>
<p>首先是原本的 SQL 語句如何將存有劃記的書本抓出來：<br>
<!-- -->Bookmark 表並沒有記錄書名，有的是 <code>VolumeID</code>，而 content 表記錄各種書籍相關的資訊，因此要用 <code>Bookmark.VolumeID = content.BookID</code> 去做吻合。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> Bookmark</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">VolumeID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Bookmark</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">Text</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Bookmark</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Annotation</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Bookmark</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DateCreated</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Bookmark</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DateModified</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">BookTitle</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Title</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Attribution </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> Bookmark </span><span class="token keyword" style="color:#00009f">INNER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">JOIN</span><span class="token plain"> content </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> Bookmark</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">VolumeID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">BookID</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>而毀損後我發現 content 表找不到存在 <code>BookID</code> 可以吻合的資料，要不然就是某些欄位的資料應該要有卻是空的，所以我做了一些嘗試：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/* 1 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DISTINCT</span><span class="token plain"> Bookmark</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">VolumeID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">BookTitle</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ISBN </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> Bookmark </span><span class="token keyword" style="color:#00009f">INNER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">JOIN</span><span class="token plain"> content </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> Bookmark</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">VolumeID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">BookID </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">BookTitle </span><span class="token operator" style="color:#393A34">IS</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> Bookmark</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">Text</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">BookTitle</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DISTINCT</span><span class="token plain"> Bookmark</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">VolumeID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">BookTitle</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ISBN </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> Bookmark </span><span class="token keyword" style="color:#00009f">INNER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">JOIN</span><span class="token plain"> content </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> Bookmark</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">VolumeID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">BookID</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>後來我想到的交叉驗證是拿舊的 sqlite (7 月) 來比較，才更確認現在資料的缺損。</p>
<p>關於一些欄位的認識，以《我可能錯了》為例，<code>Bookmark.VolumeID</code> 為 baf25480-5f8d-48e4-b0d7-bbd004c64f8f，在 content 表搜尋任意 column，會有一筆 <code>ContentID</code> 是與 <code>VolumeID</code> 相等：<br>
<!-- -->（有意思的是，<code>BookId</code> 為空！從 <code>ImageId</code> 與 <code>Description</code> 非空推測：可能是封面頁）</p>
<table><thead><tr><th>ContentID</th><th>ContentType</th><th>MimeType</th><th>BookId</th></tr></thead><tbody><tr><td>baf25480-5f8d-48e4-b0d7-bbd004c64f8f</td><td>6</td><td>application/x-kobo-epub+zip</td><td>NULL</td></tr></tbody></table>
<p>其他則像是記錄書的章節內容（此時會和 <code>VolumeID</code> 會和 <code>BookId</code> 吻合），會有兩筆資料用 <code>Title</code> 分別記錄「第13章　有魔法的箴言」和「xhtml/p-013.xhtml」相似的資料，只差在 <code>ContentType</code> 不同：<br>
<img decoding="async" loading="lazy" alt="alt text" src="/assets/images/image-b6c0f1de6ea51caa8a3060cb1e0ac46b.png" width="3153" height="748" class="img_ev3q"></p>
<p>此時我猜把 Bookmark 表中的 <code>StartContainerPath</code> 結合這裡看到的章節資訊，應該可以做到完全的劃記排序？</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="還原方法">還原方法？<a href="#還原方法" class="hash-link" aria-label="還原方法？的直接連結" title="還原方法？的直接連結" translate="no">​</a></h3>
<p>我拿前一次的備份覆蓋掉現在閱讀器上毀損的資料，再啟動同步：</p>
<ul>
<li>閱讀時間數據停留在該次備份 (330 小時)</li>
<li><code>Bookmark.VolumeID = content.BookID</code> 可以抓出吻合，資料還算正常</li>
<li>⚠️ 新增的劃記不會更新到 sqlite，資料彷彿凍結，而且最重要的是在閱讀器內部檢視，全部都空的！</li>
</ul>
<p>推估是因為 8 月時 Kobo 有更新過一次，所以導致要以那之前的 sqlite 資料來做基底會有問題。</p>
<p>最後只好把被我弄壞掉的 sqlite 再丟回去覆蓋，再同步：</p>
<ul>
<li>閱讀時間數據——440 小時，啪地沒了。</li>
<li>新增的劃記可以更新到 sqlite，在閱讀器內部檢視還都能檢視到舊的劃記</li>
</ul>
<p>還有些書籍無法開啟的問題，只要移除閱讀器上的書籍資料再重新下載即可。</p>
<p>還有一個交叉測試是，我開啟 <code>Kobo eReader.conf</code> 的設定：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[FeatureSettings]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExportHighlights=true</span><br></span></code></pre></div></div>
<p>這樣輸出的劃記是<strong>正常</strong>的，儘管我的 sqlite 是壞的，甚至我到 Bookmark 表查不到我新增的劃記內容。<br>
<!-- -->讓我非常好奇這些正常的劃記是不是從線上的資料庫而來的，算了也無從得知。</p>
<p>就先記錄到這裡吧，學到的教訓就是：不要貪圖一時方便不備份……</p>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_LWe7 sr-only" id="footnote-label">Footnotes<a href="#footnote-label" class="hash-link" aria-label="Footnotes的直接連結" title="Footnotes的直接連結" translate="no">​</a></h2>
<ol>
<li id="user-content-fn-ereader-a4d644">
<p>剛好趁 9 月周年慶購入 Kobo Libra Colour（7 吋） <a href="#user-content-fnref-ereader-a4d644" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-sql-a4d644">
<p>上次碰資料庫應該是大二修課、大三做專題，10 年過去了！😱 <a href="#user-content-fnref-sql-a4d644" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-memo-a4d644">
<p>由於斷斷續續寫這篇文章，等到真的正式記錄已經要 2 週過去，我已經有點看不懂我當初的 memo ㄌ… <a href="#user-content-fnref-memo-a4d644" data-footnote-backref="" aria-label="Back to reference 3" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section></div><footer class="row docusaurus-mt-lg"><div class="col"><b>標籤：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/programming">Programming</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="部落格文章列表分頁導覽"></nav></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">外部連結</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://steamcommunity.com/id/sortof-jing/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Steam<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/Shen-Jing" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Shen Jing</div></div></div></footer></div>
</body>
</html>